{{ $item := .item }}

{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

{{ $resource := partial "functions/get_featured_image.html" $item }}
{{ $anchor := $item.Params.image.focal_point | default "Center" }}
{{ $fill_image := .config.fill_image | default true }}
{{ $showDate := .config.show_date | default true }}
{{ $showReadTime := .config.show_read_time | default true }}
{{ $showReadMore := .config.show_read_more | default true }}
{{ $hasMeta := or $showDate $showReadTime $showReadMore }}
{{ $index := .index }}

<div class="group bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm rounded-2xl ring-1 ring-zinc-900/5 dark:ring-white/10 shadow-lg overflow-hidden transition-all duration-300 ease-out hover:shadow-xl hover:shadow-blue-500/10 hover:-translate-y-2 focus-within:ring-2 focus-within:ring-blue-500/50" role="article" aria-labelledby="card-title-{{ $item.File.UniqueID }}">
    <!-- Image Section -->
    <div class="relative overflow-hidden bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-800 dark:to-zinc-900">
      {{ with $item.Params.content_meta }}
        {{ if .trending }}
          <div class="absolute top-3 right-3 z-10 inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[11px] font-semibold bg-black/55 backdrop-blur-sm text-white shadow-sm">
            <span>{{ i18n "trending" | default "Trending" }}</span>
            <span aria-hidden="true">üî•</span>
          </div>
        {{ end }}
      {{ end }}
      {{ with $resource }}
        {{ if ne .MediaType.SubType "gif" }}
          {{ $original_image := .Resize "800x" }}
          {{ $responsive := partial "functions/process_responsive_image.html" (dict 
              "image" $original_image 
              "mode" "responsive"
              "sizes" (slice 400 600 800)
              "formats" (slice "avif" "webp" "jpg")
          ) }}
          <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block">
            <img class="w-full h-auto transition-transform duration-500 ease-out group-hover:scale-105 object-contain" 
                 srcset="{{ $responsive.srcset }}"
                 sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                 src="{{ $responsive.fallback.RelPermalink }}" 
                 width="{{ $original_image.Width }}" 
                 height="{{ $original_image.Height }}"
                 loading="lazy" 
                 decoding="async"
                 {{ if eq $index 0 }}fetchpriority="high"{{ end }}
                 alt="{{ $item.Title | plainify }} featured image">
          </a>
        {{ else }}
          <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block">
            <img class="w-full h-auto transition-transform duration-500 ease-out group-hover:scale-105 object-contain"
                 src="{{ .RelPermalink }}"
                 width="{{ .Width }}"
                 height="{{ .Height }}"
                 loading="lazy"
                 decoding="async"
                 alt="{{ $item.Title | plainify }} featured image">
          </a>
        {{ end }}
      {{ else }}
        <!-- Fallback gradient with subtle pattern -->
        <div class="w-full h-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center">
          <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
            <svg class="w-8 h-8 text-white/60" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
          </div>
        </div>
      {{end}}
      
      <!-- Subtle overlay for better text contrast (allow clicks to pass through) -->
      <div class="absolute inset-0 pointer-events-none bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
    </div>

    <!-- Content Section -->
    <div class="p-8 space-y-4">
      {{ with $item.Params.content_meta }}
        {{ if or .content_type .difficulty }}
        <div class="flex items-center gap-x-4">
          {{ with .content_type }}
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
            {{ . }}
          </span>
          {{ end }}
          {{ with .difficulty }}
          <span class="text-sm font-medium text-zinc-600 dark:text-zinc-400">{{ i18n "difficulty" }}: {{ . }}</span>
          {{ end }}
        </div>
        {{ end }}
      {{ end }}

      {{ if and $item.Params.tags (gt (len $item.Params.tags) 0) }}
      {{ $labels := $item.Params.tags }}
      <style>
        /* Local tooltip styles via pseudo element; applies on lists and singles */
        .tag-hint::after {
          content: attr(data-tooltip);
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          margin-bottom: 0.5rem;
          padding: 0.25rem 0.75rem;
          font-size: 0.75rem;
          background-color: #1a1a1a;
          color: #ffffff;
          border-radius: 0.25rem;
          display: inline-block;
          white-space: nowrap;
          text-align: center;
          pointer-events: none;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
          z-index: 50;
        }
        .tag-hint:hover::after { opacity: 1; visibility: visible; }
      </style>
      <div class="flex items-center gap-2 flex-wrap">
        {{ range $i, $label := $labels }}
          {{ $norm := lower (trim $label " ") }}
          {{ if eq $norm "neurips 2025" }}
            <span class="tag-hint" data-tooltip="Reject  Final Score: 5443" style="position:relative;display:inline-flex;align-items:center;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;user-select:none;background-color:#FEE2E2;color:#7F1D1D;">{{ $label }}</span>
          {{ else if eq $norm "cvpr 2026" }}
            <span class="tag-hint" data-tooltip="Submitting" style="position:relative;display:inline-flex;align-items:center;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;user-select:none;background-color:#DCFCE7;color:#065F46;">{{ $label }}</span>
          {{ else if eq $norm "aaai 2026" }}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-primary-200 text-primary-900 dark:bg-primary-900/60 dark:text-primary-200 select-none">{{ $label }}</span>
          {{ else if eq $norm "aaai 2025" }}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-primary-200 text-primary-900 dark:bg-primary-900/60 dark:text-primary-200 select-none">{{ $label }}</span>
          {{ else }}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-primary-100 text-primary-800 dark:bg-primary-900/40 dark:text-primary-300 select-none">{{ $label }}</span>
          {{ end }}
        {{ end }}
      </div>
      {{ end }}

      <h3 id="card-title-{{ $item.File.UniqueID }}" class="text-xl font-bold tracking-tight text-zinc-900 dark:text-zinc-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200 leading-tight">
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="hover:underline">
          {{ $item.Title }}
          {{ if $item.Params.external_link }}
            {{ partial "functions/get_icon" (dict "name" "arrow-top-right-on-square" "attributes" "style=\"height: 1em;\" class=\"inline-flex h-4 w-4 ml-1 align-text-top\"") }}
          {{ end }}
        </a>
      </h3>
      
      {{ $authors := $item.Params.authors }}
      {{ if $authors }}
      <p class="authors-line text-zinc-600 dark:text-zinc-400 text-base leading-relaxed">
        {{- $targetName := "Chuchen Guo" -}}
        {{- $home := site.Home.RelPermalink -}}
        {{- range $i, $a := $authors -}}
          {{- $name := replace $a "‚Åé" "" -}}
          {{- if gt $i 0 }}, {{ end -}}
          {{- $url := $home -}}
          {{- if eq $name "Zheng Liu" -}}
            {{- $url = "https://grzy.cug.edu.cn/ZhengLiu/zh_CN/index.htm" -}}
          {{- else if eq $name "Ying He" -}}
            {{- $url = "https://personal.ntu.edu.sg/yhe/" -}}
          {{- end -}}
          <a href="{{ $url }}" class="hover:underline" {{ if hasPrefix $url "http" }}target="_blank" rel="noopener"{{ end }}>
            {{- if eq $name $targetName -}}<strong>{{ $name }}</strong>{{- else -}}{{ $name }}{{- end -}}
          </a>{{ if (in $a "‚Åé") }}<sup>‚Åé</sup>{{ end }}
        {{- end -}}
      </p>
      {{ else }}
      <p class="text-zinc-600 dark:text-zinc-400 text-base leading-relaxed line-clamp-3">
        {{ ($item.Params.summary | default $item.Summary) | plainify | htmlUnescape | truncate 180 }}
      </p>
      {{ end }}

      <!-- Bottom metadata removed per customization (no publication_short / read more) -->
      
      <!-- Optional AI metadata -->
      {{ if $item.Params.ai_insights }}
        <div class="flex items-center gap-2 pt-2 text-xs text-blue-500 bg-blue-50 dark:bg-blue-950/30 rounded-lg px-3 py-2">
          <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="font-medium">{{ i18n "ai_insight" }}:</span>
          <span class="text-zinc-600 dark:text-zinc-400">{{ $item.Params.ai_insights }}</span>
        </div>
      {{ end }}
    </div>

</div>


